import{r as n,U as j,w as b,j as e,B as w,av as be,a6 as q,W as X,Z as Ce}from"./app-lPWvVKsc.js";import{F as Q}from"./FormInput-DxEhjFwt.js";import{I as G}from"./TextInput-Dn7eC7lC.js";import{I as P}from"./InputLabel-BCFStFdE.js";import{g as we,d as ye,a as oe,s as Oe}from"./laravelBlade-DnAXOTAM.js";import{U as ze,P as Re,s as ee}from"./index-B2SMkMCG.js";import{I as Se}from"./index-DjWH4kQ6.js";import{R as $e}from"./DeleteOutlined-BN_GPNWk.js";import{R as Me}from"./PlusOutlined-bTj_iHfT.js";import{F as Ee,G as Ie,p as He,u as _e,s as Be}from"./LayoutBreadcrumb-HJgglDuQ.js";import{E as $,u as le,a as ie,T as H,b as ke,c as Le,L as Pe,w as Ae,d as Fe,e as Ne,f as te,S as Te,g as Ve,_ as Ue,h as ae,p as se,i as De}from"./mark-BnXt_VYG.js";import{U as qe,E as Ge}from"./UploadInput-BVipupK-.js";import{M as Ke}from"./index-CfJWtGlJ.js";import{A as ue}from"./index-Bbr3eH10.js";import{F as de}from"./ApplicationLogo-CaRytBbP.js";import{C as me}from"./index-CUsB7CMy.js";import{R as ne}from"./index-B0jdu_Cb.js";import{F as Xe}from"./index-ByIMgK2I.js";import{X as Ye}from"./transition-v4w8w6CZ.js";var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-center",theme:"outlined"},We=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:Je}))},Ze=n.forwardRef(We),Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-left",theme:"outlined"},et=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:Qe}))},tt=n.forwardRef(et),at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-right",theme:"outlined"},st=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:at}))},nt=n.forwardRef(st),rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},ct=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:rt}))},ot=n.forwardRef(ct),lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"},it=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:lt}))},ut=n.forwardRef(it),dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"},mt=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:dt}))},ft=n.forwardRef(mt),pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 416H616c-4.4 0-8 3.6-8 8v112c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-56h60v320h-46c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h164c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8h-46V480h60v56c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V424c0-4.4-3.6-8-8-8zM656 296V168c0-4.4-3.6-8-8-8H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8z"}}]},name:"font-size",theme:"outlined"},gt=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:pt}))},ht=n.forwardRef(gt),vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"},xt=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:vt}))},jt=n.forwardRef(xt),bt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M648 160H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V168c0-4.4-3.6-8-8-8zm272.8 546H856V318h64.8c6 0 9.4-7 5.7-11.7L825.7 178.7a7.14 7.14 0 00-11.3 0L713.6 306.3a7.23 7.23 0 005.7 11.7H784v388h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5a7.2 7.2 0 00-5.6-11.7z"}}]},name:"line-height",theme:"outlined"},Ct=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:bt}))},wt=n.forwardRef(Ct),yt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 476H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"line",theme:"outlined"},Ot=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:yt}))},zt=n.forwardRef(Ot),Rt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"},St=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:Rt}))},$t=n.forwardRef(St),Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},Et=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:Mt}))},It=n.forwardRef(Et),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},_t=function(t,s){return n.createElement(j,b({},t,{ref:s,icon:Ht}))},Bt=n.forwardRef(_t),fe=(a=>(a.POST="POST",a.PATCH="PATCH",a))(fe||{});const kt=a=>{const t=a.type==="image/jpeg"||a.type==="image/png";t||ee.error("You can only upload JPG/PNG file!");const s=a.size/1024/1024<10;return s||ee.error("Image must smaller than 10MB!"),t&&s},Lt=({onChangeData:a,onChangeFile:t,name:s,value:r,action:l,method:o,storageFolder:f,chapterId:d,page:h,label:p,chapter:C,bookId:g})=>{const[c,u]=n.useState(0),[v,m]=n.useState(!1),[M,R]=n.useState(!1),[_,B]=n.useState(r),[E,k]=n.useState(""),L=!!_,F=y=>{const i=y==null?void 0:y.fileList[0].originFileObj;t&&t(i)},N=()=>{B("")},T=e.jsxs("button",{style:{border:0,background:"none",width:340,height:520},type:"button",children:[v?e.jsx(be,{}):e.jsx(Me,{}),e.jsx("div",{style:{marginTop:8},children:"Upload"})]}),V=async y=>{var W,Z;const{onSuccess:i,onError:O,file:ve,onProgress:xe}=y,S=new FormData,J={headers:{"content-type":"multipart/form-data"},onUploadProgress:x=>{const I=Math.floor(x.loaded/x.total*100);u(I),I===100&&setTimeout(()=>u(0),1e3),xe({percent:x.loaded/x.total*100})}};d&&S.append("chapter_id",d),g&&S.append("book_id",g),S.append("chapter",C),S.append("page",h),S.append(s,ve);try{u(10),m(!0),R(!1),k("");let x;o==="PATCH"?x=await q.patch(l,S,J):x=await q.post(l,S,J),i("Ok");const{data:I}=x.data,je=I.img_url||"";B(je),a(I),R(!0),m(!1)}catch(x){O({err:x}),k(((Z=(W=x==null?void 0:x.response)==null?void 0:W.data)==null?void 0:Z.message)||""),m(!1)}},U={size:"small",percent:c,...c===100&&!E?{}:{status:E?"exception":"active"}};return e.jsxs("div",{className:"mt-4",children:[p?e.jsx(P,{className:"mb-2",value:p}):null,e.jsxs(ze,{accept:"image/png, image/jpeg",customRequest:V,name:s,listType:"picture",className:`manga-page ${M?"success-upload":""} ${E?"error-upload":""}`,showUploadList:!1,action:route("profile.api.upload_avatar"),beforeUpload:kt,onChange:F,multiple:!1,maxCount:1,headers:{"X-CSRF-TOKEN":we("csrf-token")},children:[L?e.jsx(Se,{preview:!1,fallback:ye,src:oe(`storage/${f}/${_}`),alt:"image",style:{width:"100%"}}):T,L?e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(w,{className:"bg-transparent hover:bg-transparent",onClick:N,icon:e.jsx($e,{}),danger:!0,type:"dashed",shape:"circle"})}):null]}),e.jsx("div",{className:"h-4 w-10/12 mx-auto",children:c>0?e.jsx(Re,{...U}):null}),e.jsx("div",{className:"h-6",children:e.jsx(G,{message:E})})]})},Pt=a=>{const{initialValues:t,chapterId:s}=a,{data:r,setData:l,processing:o,errors:f,recentlySuccessful:d}=X(t),h={bookId:t==null?void 0:t.book_id,chapterId:s,chapter:t.chapter},p=c=>{l("img_url",c.img_url);const u={...r.list,[c.id]:c};l("list",u)},C=Array.from(Object.entries(r.list),([c,u])=>u),g=Array.from({length:C.length+1},(c,u)=>u+1);return e.jsx(Ee,{gutter:[16,16],children:g.map(c=>{const u=C.find(v=>v.page===c);return e.jsx(Ie,{className:"text-center",sm:24,md:12,lg:8,children:e.jsx(Lt,{label:`Page ${c}`,name:"manga_page_file",method:fe.POST,action:route("pages.api.upload.manga"),onChangeData:p,value:(u==null?void 0:u.img_url)||"",storageFolder:"chapter-pages",page:c,...h})},c)})})},pe=(a,t)=>{const s=$.marks(a);return s?s[t]===!0:!1},ge=(a,t)=>{pe(a,t)?$.removeMark(a,t):$.addMark(a,t,!0)},D=({format:a,icon:t})=>{const s=le(),r=pe(s,a)?"primary":"default";return e.jsx(w,{icon:t,type:r,onMouseDown:l=>{l.preventDefault(),ge(s,a)}})},re=["numbered-list","bulleted-list"],he=(a,t,s="type")=>{const{selection:r}=a;if(!r)return!1;const[l]=Array.from($.nodes(a,{at:$.unhangRange(a,r),match:o=>!$.isEditor(o)&&ie.isElement(o)&&o[s]===t}));return!!l},At=(a,t)=>{const s=he(a,t,A.includes(t)?"align":"type"),r=re.includes(t);H.unwrapNodes(a,{match:o=>!$.isEditor(o)&&ie.isElement(o)&&re.includes(o.type)&&!A.includes(t),split:!0});let l;if(A.includes(t)?l={align:s?void 0:t}:l={type:s?"paragraph":r?"list-item":t},H.setNodes(a,l),!s&&r){const o={type:t,children:[]};H.wrapNodes(a,o)}},A=["left","center","right"],z=({format:a,icon:t,title:s})=>{const r=le(),l=he(r,a,A.includes(a)?"align":"type")?"primary":"default";return e.jsx(w,{icon:s?null:t,type:l,onMouseDown:o=>{o.preventDefault(),At(r,a)},children:s})};var Ft=Ut,Nt=/^(?:\w+:)?\/\/(\S+)$/,Tt=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Vt=/^[^\s\.]+\.\S{2,}$/;function Ut(a){if(typeof a!="string")return!1;var t=a.match(Nt);if(!t)return!1;var s=t[1];return s?!!(Tt.test(s)||Vt.test(s)):!1}const Dt=Ce(Ft),qt=["ase","art","bmp","blp","cd5","cit","cpt","cr2","cut","dds","dib","djvu","egt","exif","gif","gpl","grf","icns","ico","iff","jng","jpeg","jpg","jfif","jp2","jps","lbm","max","miff","mng","msp","nitf","ota","pbm","pc1","pc2","pc3","pcf","pcx","pdn","pgm","PI1","PI2","PI3","pict","pct","pnm","pns","ppm","psb","psd","pdd","psp","px","pxm","pxr","qfx","raw","rle","sct","sgi","rgb","int","bw","tga","tiff","tif","vtf","xbm","xcf","xpm","3dv","amf","ai","awg","cgm","cdr","cmx","dxf","e2d","egt","eps","fs","gbr","odg","svg","stl","vrml","x3d","sxd","v2d","vnd","wmf","emf","art","xar","png","webp","jxr","hdp","wdp","cur","ecw","iff","lbm","liff","nrrd","pam","pcx","pgf","sgi","rgb","rgba","bw","int","inta","sid","ras","sun","tga"],K=(a,t)=>{const r={type:"image",url:t,children:[{text:""}]};H.insertNodes(a,r),H.insertNodes(a,{type:"paragraph",children:[{text:""}]})},Gt=({bookId:a,chapter:t})=>{const s=ke(),[r,l]=n.useState(!1),[o,f]=n.useState(!1),{data:d,setData:h}=X({file_url:"",from:"",to:"",file_name:"",bookId:a}),p=t?`/Ch_${t}`:"",C=n.useCallback(()=>{f(!o)},[o]),g=async()=>{if(d.file_url)try{l(!0);const m=await q({method:"POST",url:route("api.upload.transfer"),data:d});K(s,oe(`storage/${m.data.data}`)),f(!1),h({file_url:"",from:"",to:"",file_name:"",bookId:a})}catch(m){console.error(m)}finally{l(!1)}},c=n.useCallback(m=>{const M=`${t}_${Oe(12)}.webp`;h({file_url:m,from:`tmp/${m}`,to:`upload/novels/${a}${p}`,file_name:M,bookId:a})},[t,a,p]),u=n.useCallback(()=>{h({file_url:"",from:"",to:"",file_name:"",bookId:a}),f(!1)},[]),v=!d.file_url;return e.jsxs(e.Fragment,{children:[e.jsx(w,{icon:e.jsx(ft,{}),onClick:C,type:o?"primary":"default"}),e.jsx(Ke,{title:"Upload Image",open:o,onOk:g,onCancel:u,footer:[e.jsx(w,{onClick:u,children:"Cancel"},"back"),e.jsx(w,{disabled:v,loading:r,type:"primary",onClick:g,children:"OK"},"submit")],children:e.jsx(qe,{name:"cover_file",method:Ge.POST,action:route("api.upload.store"),onChangeUrl:c,value:d.file_url||"",folderName:`novels/${a}`})})]})},Kt=a=>{if(!a||!Dt(a))return!1;const t=new URL(a).pathname.split(".").pop();return qt.includes(t)},Xt=({bookId:a,chapter:t})=>e.jsx(ue,{offsetTop:40,children:e.jsx(de,{justify:"end",children:e.jsxs(He.Compact,{className:" mx-2 mb-2",children:[e.jsx(D,{format:"bold",icon:e.jsx(ot,{})}),e.jsx(D,{format:"italic",icon:e.jsx(jt,{})}),e.jsx(D,{format:"underline",icon:e.jsx(Bt,{})}),e.jsx(Gt,{bookId:a,chapter:t}),e.jsx(z,{format:"divider",icon:e.jsx(zt,{})}),e.jsx(z,{format:"heading-one",icon:e.jsx(wt,{})}),e.jsx(z,{format:"heading-two",icon:e.jsx(ht,{})}),e.jsx(z,{format:"block-code",icon:e.jsx(ut,{})}),e.jsx(z,{format:"block-quote",icon:e.jsx($t,{})}),e.jsx(z,{format:"left",icon:e.jsx(tt,{})}),e.jsx(z,{format:"center",icon:e.jsx(Ze,{})}),e.jsx(z,{format:"right",icon:e.jsx(nt,{})})]})})}),Yt=a=>{const{insertData:t,isVoid:s}=a;return a.isVoid=r=>r.type==="image"?!0:s(r),a.insertData=r=>{const l=r.getData("text/plain"),{files:o}=r;if(o&&o.length>0)for(const f of o){const d=new FileReader,[h]=f.type.split("/");h==="image"&&(d.addEventListener("load",()=>{const p=d.result;K(a,p)}),d.readAsDataURL(f))}else Kt(l)?K(a,l):t(r)},a},ce={"Control+b":"bold","Control+i":"italic","Control+u":"underline","Control+`":"code","Control+q":"block-quote"},Jt=({initialValue:a,onChange:t,bookId:s,chapter:r})=>{const[l,o]=n.useState(!1),[f,d]=n.useState([]),h=n.useCallback(c=>e.jsx(Le,{...c}),[]),p=n.useCallback(c=>e.jsx(Pe,{...c}),[]),C=n.useMemo(()=>Yt(Ae(Fe(Ne()))),[]),g=n.useCallback(c=>{if(C.operations.some(v=>v.type!=="set_selection")){const v=te(c);d(v),t&&t(v)}},[]);return n.useEffect(()=>{l||o(!0)},[]),l?e.jsx(Te,{editor:C,initialValue:te(a),onChange:c=>g(c),children:e.jsxs(me,{size:"small",children:[e.jsx(Xt,{bookId:s,chapter:r}),e.jsx(Ve,{renderElement:h,renderLeaf:p,placeholder:"Enter some content...",spellCheck:!0,autoFocus:!0,className:"px-2 b-none outline-none",style:{fontSize:18},onKeyDown:c=>{for(const u in ce)if(Ue(u,c)){c.preventDefault();const v=ce[u];ge(C,v)}}})]})}):null},ha=({bookType:a,type:t,initialValues:s,chapterId:r,languages:l,listButtons:o,max:f,bookId:d})=>{const{user:h}=_e(),[p,C]=n.useState(!1),{data:g,post:c,patch:u,reset:v,setData:m,processing:M,errors:R,recentlySuccessful:_}=X(s),B=({target:{value:i}})=>{m("status",i)},E=({target:{value:i}})=>{m("language_id",parseInt(i))},k=l.map(i=>({label:i.name,value:i.id})),L=[{label:"Draft",value:"Draft"},{label:"Published",value:"Published",disabled:t==="create"&&a!=="Novel"}],F=s.novel_content.length?[]:[ae({text:"Chapter"})],N=r?[...F,...s.novel_content]:[ae({text:`Chapter ${f+1}`}),se({text:"ชื่อเรื่อง",bold:!0}),se({text:`By. ${h.name||""}`}),De],T=i=>{switch(i.preventDefault(),t){case"create":c(route("chapters.store"));break;case"update":u(route("chapters.update",r));break}},V={img_url:null,book_id:d,chapter:s.chapter,list:s.pages.reduce((i,O)=>(i[O.id]=O,i),{})},Y=t==="update"?[]:[Math.floor(f)+1],U=[...o,...Y],y=a==="Novel";return e.jsxs(me,{children:[p?null:e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mb-2",value:"Chapter"}),e.jsxs(de,{wrap:!0,gap:"small",children:[U.map(i=>{let O;switch(t){case"create":O=i<=f;break;case"update":O=i!==s.chapter;break}return e.jsx(w,{disabled:O,type:"primary",shape:"circle",children:i},i)}),e.jsx(w,{icon:e.jsx(Be,{}),onClick:()=>C(!0),type:"primary",children:"แก้ไขเลขตอน"})]})]}),e.jsxs("form",{onSubmit:T,className:"mt-6 space-y-6",children:[p?e.jsx(Q,{label:"Chapter",type:"number",name:"chapter",value:g.chapter,onChange:i=>m("chapter",parseInt(i.target.value)),required:!0,isFocused:!0,errorMessage:R.chapter}):null,e.jsx(Q,{label:"Title",type:"text",name:"title",value:g.title,onChange:i=>m("title",i.target.value),required:!0,isFocused:!0,errorMessage:R.title}),e.jsxs("div",{children:[e.jsx(P,{className:"mb-2",htmlFor:"language_id",value:"Language"}),e.jsx(ne.Group,{name:"language_id",options:k,onChange:E,value:g.language_id,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(G,{className:"mt-2",message:R.language_id})]}),s.status==="Published"?null:e.jsxs("div",{children:[e.jsx(P,{className:"mb-2",htmlFor:"status",value:"Status"}),e.jsx(ne.Group,{name:"status",options:L,onChange:B,value:g.status,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(G,{className:"mt-2",message:R.status})]}),y?e.jsx(Jt,{initialValue:N,onChange:i=>m("novel_content",i),bookId:d,chapter:s.chapter}):null,r&&!y?e.jsx(Pt,{initialValues:V,chapterId:r}):null,e.jsx(ue,{offsetBottom:50,children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(w,{htmlType:"submit",icon:e.jsx(It,{}),size:"large",type:"primary",loading:M,disabled:M,children:"Save"}),e.jsx(Ye,{show:_,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Saved."})})]})}),e.jsx(Xe.BackTop,{})]})]})};export{ha as C};
