import{r as n,X as x,y as j,j as e,B as O,ab as xe,a7 as q,W as K,g as je}from"./app-seHo-2Pj.js";import{F as be}from"./FormInput-BR6tTzwd.js";import{I as G}from"./TextInput-DWkgGXts.js";import{I as P}from"./InputLabel-lrheF2GI.js";import{g as we,d as Ce,a as re,s as ye,F as ce}from"./ApplicationLogo-Dsn01JS_.js";import{U as Oe,P as ze}from"./index-q3HBubqJ.js";import{I as Re}from"./index-CjLUmZqW.js";import{R as Se}from"./DeleteOutlined-BRSLxfDv.js";import{s as Q}from"./index-BDXsA6_q.js";import{R as $e}from"./PlusOutlined-C_6t6gwO.js";import{p as Me,C as Ee,S as He,u as Ie}from"./FooterLayout-Vber5aYW.js";import{E as R,u as oe,a as le,T as E,b as _e,c as Be,L as Le,w as Pe,d as ke,e as Ae,f as Z,S as Ne,g as Fe,_ as Te,h as ee,p as te,i as Ve}from"./mark-DDPbkPNo.js";import{U as Ue,E as De}from"./UploadInput-CrHLOrAU.js";import{M as qe}from"./index-CSdIa1NU.js";import{A as ie}from"./index-MxScGk_T.js";import{C as Ge}from"./index-B4QU2BuM.js";import{R as ae}from"./index-v-2VLZ_O.js";import{F as Xe}from"./index-ClzvzJZk.js";import{X as Ke}from"./transition-C_GOONea.js";var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M264 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm496 424c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H264c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496zm144 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-center",theme:"outlined"},Je=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:Ye}))},We=n.forwardRef(Je),Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-left",theme:"outlined"},Ze=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:Qe}))},et=n.forwardRef(Ze),tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 158H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 424H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 212H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"align-right",theme:"outlined"},at=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:tt}))},st=n.forwardRef(at),nt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"}}]},name:"bold",theme:"outlined"},rt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:nt}))},ct=n.forwardRef(rt),ot={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M516 673c0 4.4 3.4 8 7.5 8h185c4.1 0 7.5-3.6 7.5-8v-48c0-4.4-3.4-8-7.5-8h-185c-4.1 0-7.5 3.6-7.5 8v48zm-194.9 6.1l192-161c3.8-3.2 3.8-9.1 0-12.3l-192-160.9A7.95 7.95 0 00308 351v62.7c0 2.4 1 4.6 2.9 6.1L420.7 512l-109.8 92.2a8.1 8.1 0 00-2.9 6.1V673c0 6.8 7.9 10.5 13.1 6.1zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"code",theme:"outlined"},lt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:ot}))},it=n.forwardRef(lt),ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M553.1 509.1l-77.8 99.2-41.1-52.4a8 8 0 00-12.6 0l-99.8 127.2a7.98 7.98 0 006.3 12.9H696c6.7 0 10.4-7.7 6.3-12.9l-136.5-174a8.1 8.1 0 00-12.7 0zM360 442a40 40 0 1080 0 40 40 0 10-80 0zm494.6-153.4L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-image",theme:"outlined"},dt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:ut}))},mt=n.forwardRef(dt),ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M920 416H616c-4.4 0-8 3.6-8 8v112c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-56h60v320h-46c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h164c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8h-46V480h60v56c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V424c0-4.4-3.6-8-8-8zM656 296V168c0-4.4-3.6-8-8-8H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8z"}}]},name:"font-size",theme:"outlined"},pt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:ft}))},gt=n.forwardRef(pt),ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M798 160H366c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h181.2l-156 544H229c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8H474.4l156-544H798c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"italic",theme:"outlined"},vt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:ht}))},xt=n.forwardRef(vt),jt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M648 160H104c-4.4 0-8 3.6-8 8v128c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-64h168v560h-92c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-92V232h168v64c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V168c0-4.4-3.6-8-8-8zm272.8 546H856V318h64.8c6 0 9.4-7 5.7-11.7L825.7 178.7a7.14 7.14 0 00-11.3 0L713.6 306.3a7.23 7.23 0 005.7 11.7H784v388h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5a7.2 7.2 0 00-5.6-11.7z"}}]},name:"line-height",theme:"outlined"},bt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:jt}))},wt=n.forwardRef(bt),Ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 476H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"line",theme:"outlined"},yt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:Ct}))},Ot=n.forwardRef(yt),zt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"},Rt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:zt}))},St=n.forwardRef(Rt),$t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},Mt=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:$t}))},Et=n.forwardRef(Mt),Ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824 804H200c-4.4 0-8 3.4-8 7.6v60.8c0 4.2 3.6 7.6 8 7.6h624c4.4 0 8-3.4 8-7.6v-60.8c0-4.2-3.6-7.6-8-7.6zm-312-76c69.4 0 134.6-27.1 183.8-76.2C745 602.7 772 537.4 772 468V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 97-79 176-176 176s-176-79-176-176V156c0-6.6-5.4-12-12-12h-60c-6.6 0-12 5.4-12 12v312c0 69.4 27.1 134.6 76.2 183.8C377.3 701 442.6 728 512 728z"}}]},name:"underline",theme:"outlined"},It=function(t,s){return n.createElement(x,j({},t,{ref:s,icon:Ht}))},_t=n.forwardRef(It),ue=(a=>(a.POST="POST",a.PATCH="PATCH",a))(ue||{});const Bt=a=>{const t=a.type==="image/jpeg"||a.type==="image/png";t||Q.error("You can only upload JPG/PNG file!");const s=a.size/1024/1024<10;return s||Q.error("Image must smaller than 10MB!"),t&&s},Lt=({onChangeData:a,onChangeFile:t,name:s,value:r,action:o,method:l,storageFolder:m,chapterId:d,page:h,label:f,chapter:b,bookId:C})=>{const[c,i]=n.useState(0),[p,g]=n.useState(!1),[$,H]=n.useState(!1),[I,_]=n.useState(r),[S,B]=n.useState(""),L=!!I,A=w=>{const U=w==null?void 0:w.fileList[0].originFileObj;t&&t(U)},N=()=>{_("")},F=e.jsxs("button",{style:{border:0,background:"none",width:340,height:520},type:"button",children:[p?e.jsx(xe,{}):e.jsx($e,{}),e.jsx("div",{style:{marginTop:8},children:"Upload"})]}),T=async w=>{var J,W;const{onSuccess:U,onError:pe,file:ge,onProgress:he}=w,z=new FormData,Y={headers:{"content-type":"multipart/form-data"},onUploadProgress:v=>{const M=Math.floor(v.loaded/v.total*100);i(M),M===100&&setTimeout(()=>i(0),1e3),he({percent:v.loaded/v.total*100})}};d&&z.append("chapter_id",d),C&&z.append("book_id",C),z.append("chapter",b),z.append("page",h),z.append(s,ge);try{i(10),g(!0),H(!1),B("");let v;l==="PATCH"?v=await q.patch(o,z,Y):v=await q.post(o,z,Y),U("Ok");const{data:M}=v.data,ve=M.img_url||"";_(ve),a(M),H(!0),g(!1)}catch(v){pe({err:v}),B(((W=(J=v==null?void 0:v.response)==null?void 0:J.data)==null?void 0:W.message)||""),g(!1)}},u={size:"small",percent:c,...c===100&&!S?{}:{status:S?"exception":"active"}};return e.jsxs("div",{className:"mt-4",children:[f?e.jsx(P,{className:"mb-2",value:f}):null,e.jsxs(Oe,{accept:"image/png, image/jpeg",customRequest:T,name:s,listType:"picture",className:`manga-page ${$?"success-upload":""} ${S?"error-upload":""}`,showUploadList:!1,action:route("profile.api.upload_avatar"),beforeUpload:Bt,onChange:A,multiple:!1,maxCount:1,headers:{"X-CSRF-TOKEN":we("csrf-token")},children:[L?e.jsx(Re,{preview:!1,fallback:Ce,src:re(`storage/${m}/${I}`),alt:"image",style:{width:"100%"}}):F,L?e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(O,{className:"bg-transparent hover:bg-transparent",onClick:N,icon:e.jsx(Se,{}),danger:!0,type:"dashed",shape:"circle"})}):null]}),e.jsx("div",{className:"h-4 w-10/12 mx-auto",children:c>0?e.jsx(ze,{...u}):null}),e.jsx("div",{className:"h-6",children:e.jsx(G,{message:S})})]})},Pt=a=>{const{initialValues:t,chapterId:s}=a,{data:r,setData:o,processing:l,errors:m,recentlySuccessful:d}=K(t),h={bookId:t==null?void 0:t.book_id,chapterId:s,chapter:t.chapter},f=c=>{o("img_url",c.img_url);const i={...r.list,[c.id]:c};o("list",i)},b=Array.from(Object.entries(r.list),([c,i])=>i),C=Array.from({length:b.length+1},(c,i)=>i+1);return e.jsx(Me,{gutter:[16,16],children:C.map(c=>{const i=b.find(p=>p.page===c);return e.jsx(Ee,{className:"text-center",sm:24,md:12,lg:8,children:e.jsx(Lt,{label:`Page ${c}`,name:"manga_page_file",method:ue.POST,action:route("pages.api.upload.manga"),onChangeData:f,value:(i==null?void 0:i.img_url)||"",storageFolder:"chapter-pages",page:c,...h})},c)})})},de=(a,t)=>{const s=R.marks(a);return s?s[t]===!0:!1},me=(a,t)=>{de(a,t)?R.removeMark(a,t):R.addMark(a,t,!0)},D=({format:a,icon:t})=>{const s=oe(),r=de(s,a)?"primary":"default";return e.jsx(O,{icon:t,type:r,onMouseDown:o=>{o.preventDefault(),me(s,a)}})},se=["numbered-list","bulleted-list"],fe=(a,t,s="type")=>{const{selection:r}=a;if(!r)return!1;const[o]=Array.from(R.nodes(a,{at:R.unhangRange(a,r),match:l=>!R.isEditor(l)&&le.isElement(l)&&l[s]===t}));return!!o},kt=(a,t)=>{const s=fe(a,t,k.includes(t)?"align":"type"),r=se.includes(t);E.unwrapNodes(a,{match:l=>!R.isEditor(l)&&le.isElement(l)&&se.includes(l.type)&&!k.includes(t),split:!0});let o;if(k.includes(t)?o={align:s?void 0:t}:o={type:s?"paragraph":r?"list-item":t},E.setNodes(a,o),!s&&r){const l={type:t,children:[]};E.wrapNodes(a,l)}},k=["left","center","right"],y=({format:a,icon:t,title:s})=>{const r=oe(),o=fe(r,a,k.includes(a)?"align":"type")?"primary":"default";return e.jsx(O,{icon:s?null:t,type:o,onMouseDown:l=>{l.preventDefault(),kt(r,a)},children:s})};var At=Vt,Nt=/^(?:\w+:)?\/\/(\S+)$/,Ft=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Tt=/^[^\s\.]+\.\S{2,}$/;function Vt(a){if(typeof a!="string")return!1;var t=a.match(Nt);if(!t)return!1;var s=t[1];return s?!!(Ft.test(s)||Tt.test(s)):!1}const Ut=je(At),Dt=["ase","art","bmp","blp","cd5","cit","cpt","cr2","cut","dds","dib","djvu","egt","exif","gif","gpl","grf","icns","ico","iff","jng","jpeg","jpg","jfif","jp2","jps","lbm","max","miff","mng","msp","nitf","ota","pbm","pc1","pc2","pc3","pcf","pcx","pdn","pgm","PI1","PI2","PI3","pict","pct","pnm","pns","ppm","psb","psd","pdd","psp","px","pxm","pxr","qfx","raw","rle","sct","sgi","rgb","int","bw","tga","tiff","tif","vtf","xbm","xcf","xpm","3dv","amf","ai","awg","cgm","cdr","cmx","dxf","e2d","egt","eps","fs","gbr","odg","svg","stl","vrml","x3d","sxd","v2d","vnd","wmf","emf","art","xar","png","webp","jxr","hdp","wdp","cur","ecw","iff","lbm","liff","nrrd","pam","pcx","pgf","sgi","rgb","rgba","bw","int","inta","sid","ras","sun","tga"],X=(a,t)=>{const r={type:"image",url:t,children:[{text:""}]};E.insertNodes(a,r),E.insertNodes(a,{type:"paragraph",children:[{text:""}]})},qt=({bookId:a,chapter:t})=>{const s=_e(),[r,o]=n.useState(!1),[l,m]=n.useState(!1),{data:d,setData:h}=K({file_url:"",from:"",to:"",file_name:"",bookId:a}),f=t?`/Ch_${t}`:"",b=()=>{m(!l)},C=async()=>{if(d.file_url)try{o(!0);const g=await q({method:"POST",url:route("api.upload.transfer"),data:d});X(s,re(`storage/${g.data.data}`)),m(!1),h({file_url:"",from:"",to:"",file_name:"",bookId:a})}catch(g){console.error(g)}finally{o(!1)}},c=g=>{const $=`${t}_${ye(12)}.webp`;h({file_url:g,from:`tmp/${g}`,to:`upload/novels/${a}${f}`,file_name:$,bookId:a})},i=()=>{h({file_url:"",from:"",to:"",file_name:"",bookId:a}),m(!1)},p=!d.file_url;return e.jsxs(e.Fragment,{children:[e.jsx(O,{icon:e.jsx(mt,{}),onClick:b,type:l?"primary":"default"}),e.jsx(qe,{title:"Upload Image",open:l,onOk:C,onCancel:i,footer:[e.jsx(O,{onClick:i,children:"Cancel"},"back"),e.jsx(O,{disabled:p,loading:r,type:"primary",onClick:C,children:"OK"},"submit")],children:e.jsx(Ue,{name:"cover_file",method:De.POST,action:route("api.upload.store"),onChangeUrl:c,value:d.file_url||"",folderName:`novels/${a}`})})]})},Gt=a=>{if(!a||!Ut(a))return!1;const t=new URL(a).pathname.split(".").pop();return Dt.includes(t)},Xt=({bookId:a,chapter:t})=>e.jsx(ie,{offsetTop:40,children:e.jsx(ce,{justify:"end",children:e.jsxs(He.Compact,{className:" mx-2 mb-2",children:[e.jsx(D,{format:"bold",icon:e.jsx(ct,{})}),e.jsx(D,{format:"italic",icon:e.jsx(xt,{})}),e.jsx(D,{format:"underline",icon:e.jsx(_t,{})}),e.jsx(qt,{bookId:a,chapter:t}),e.jsx(y,{format:"divider",icon:e.jsx(Ot,{})}),e.jsx(y,{format:"heading-one",icon:e.jsx(wt,{})}),e.jsx(y,{format:"heading-two",icon:e.jsx(gt,{})}),e.jsx(y,{format:"block-code",icon:e.jsx(it,{})}),e.jsx(y,{format:"block-quote",icon:e.jsx(St,{})}),e.jsx(y,{format:"left",icon:e.jsx(et,{})}),e.jsx(y,{format:"center",icon:e.jsx(We,{})}),e.jsx(y,{format:"right",icon:e.jsx(st,{})})]})})}),Kt=a=>{const{insertData:t,isVoid:s}=a;return a.isVoid=r=>r.type==="image"?!0:s(r),a.insertData=r=>{const o=r.getData("text/plain"),{files:l}=r;if(l&&l.length>0)for(const m of l){const d=new FileReader,[h]=m.type.split("/");h==="image"&&(d.addEventListener("load",()=>{const f=d.result;X(a,f)}),d.readAsDataURL(m))}else Gt(o)?X(a,o):t(r)},a},ne={"Control+b":"bold","Control+i":"italic","Control+u":"underline","Control+`":"code","Control+q":"block-quote"},Yt=({initialValue:a,onChange:t,bookId:s,chapter:r})=>{const[o,l]=n.useState(!1),[m,d]=n.useState([]),h=n.useCallback(c=>e.jsx(Be,{...c}),[]),f=n.useCallback(c=>e.jsx(Le,{...c}),[]),b=n.useMemo(()=>Kt(Pe(ke(Ae()))),[]),C=n.useCallback(c=>{if(b.operations.some(p=>p.type!=="set_selection")){const p=Z(c);d(p),t&&t(p)}},[]);return n.useEffect(()=>{o||l(!0)},[]),o?e.jsx(Ne,{editor:b,initialValue:Z(a),onChange:c=>C(c),children:e.jsxs(Ge,{size:"small",children:[e.jsx(Xt,{bookId:s,chapter:r}),e.jsx(Fe,{renderElement:h,renderLeaf:f,placeholder:"Enter some content...",spellCheck:!0,autoFocus:!0,className:"px-2 b-none outline-none",style:{fontSize:18},onKeyDown:c=>{for(const i in ne)if(Te(i,c)){c.preventDefault();const p=ne[i];me(b,p)}}})]})}):null},ga=({bookType:a,type:t,initialValues:s,chapterId:r,languages:o,listButtons:l,max:m,bookId:d})=>{const{user:h}=Ie(),{data:f,post:b,patch:C,reset:c,setData:i,processing:p,errors:g,recentlySuccessful:$}=K(s),H=({target:{value:u}})=>{i("status",u)},I=({target:{value:u}})=>{i("language_id",parseInt(u))},_=o.map(u=>({label:u.name,value:u.id})),S=[{label:"Draft",value:"Draft"},{label:"Published",value:"Published",disabled:t==="create"&&a!=="Novel"}],B=s.novel_content.length?[]:[ee({text:"Chapter"})],L=r?[...B,...s.novel_content]:[ee({text:`Chapter ${m+1}`}),te({text:"ชื่อเรื่อง",bold:!0}),te({text:`By. ${h.name||""}`}),Ve],A=u=>{switch(u.preventDefault(),t){case"create":b(route("chapters.store"));break;case"update":C(route("chapters.update",r));break}},N={img_url:null,book_id:d,chapter:s.chapter,list:s.pages.reduce((u,w)=>(u[w.id]=w,u),{})},F=t==="update"?[]:[Math.floor(m)+1],T=[...l,...F],V=a==="Novel";return e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mb-2",value:"Chapter"}),e.jsx(ce,{wrap:!0,gap:"small",children:T.map(u=>{let w;switch(t){case"create":w=u<=m;break;case"update":w=u!==s.chapter;break}return e.jsx(O,{disabled:w,type:"primary",shape:"circle",children:u},u)})}),e.jsxs("form",{onSubmit:A,className:"mt-6 space-y-6",children:[e.jsx(be,{label:"Title",value:f.title,type:"text",name:"title",onChange:u=>i("title",u.target.value),required:!0,isFocused:!0,errorMessage:g.title}),e.jsxs("div",{children:[e.jsx(P,{className:"mb-2",htmlFor:"language_id",value:"Language"}),e.jsx(ae.Group,{name:"language_id",options:_,onChange:I,value:f.language_id,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(G,{className:"mt-2",message:g.language_id})]}),s.status==="Published"?null:e.jsxs("div",{children:[e.jsx(P,{className:"mb-2",htmlFor:"status",value:"Status"}),e.jsx(ae.Group,{name:"status",options:S,onChange:H,value:f.status,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(G,{className:"mt-2",message:g.status})]}),V?e.jsx(Yt,{initialValue:L,onChange:u=>i("novel_content",u),bookId:d,chapter:s.chapter}):null,r&&!V?e.jsx(Pt,{initialValues:N,chapterId:r}):null,e.jsx(ie,{offsetBottom:50,children:e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(O,{htmlType:"submit",icon:e.jsx(Et,{}),size:"large",type:"primary",disabled:p,children:"Save"}),e.jsx(Ke,{show:$,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Saved."})})]})}),e.jsx(Xe.BackTop,{})]})]})};export{ga as C};
