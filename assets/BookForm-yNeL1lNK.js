import{r as k,j as e,B as M,av as D,a6 as F,W as L}from"./app-DV9NRXND.js";import{P as _}from"./PrimaryButton-5loc_afy.js";import{F as z}from"./FormInput--c9u8Auq.js";import{I as y}from"./TextInput-Q7OBqHDO.js";import{I as w}from"./InputLabel-BLNzXVLX.js";import{g as A,d as E,a as G}from"./ApplicationLogo-BttutHq_.js";import{U as H,P as q,s as O}from"./index-DeQSvg7P.js";import{I as V}from"./index-B3DRfpBm.js";import{R as X}from"./DeleteOutlined-CP_uMJld.js";import{R as $}from"./PlusOutlined-B8Fa1fb7.js";import{v as J,q as W}from"./FooterLayout-BQyBW5O-.js";import{C as K}from"./CategoryFilter-CfLWQ9B3.js";import{C as Y}from"./index-DYFJxuvL.js";import{R as U}from"./index-Cbo5CzgP.js";import{X as Q}from"./transition-DikKSpAg.js";var B=(a=>(a.POST="POST",a.PATCH="PATCH",a))(B||{});const Z=a=>{const i=a.type==="image/jpeg"||a.type==="image/png";i||O.error("You can only upload JPG/PNG file!");const c=a.size/1024/1024<2;return c||O.error("Image must smaller than 2MB!"),i&&c},ee=({onChangeUrl:a,onChangeFile:i,name:c,value:h,action:u,method:m,bookId:o})=>{const[x,f]=k.useState(0),[I,r]=k.useState(!1),[d,n]=k.useState(h),v=!!d,b=p=>{const g=p==null?void 0:p.fileList[0].originFileObj;i&&i(g)},C=()=>{n("")},P=e.jsxs("button",{style:{border:0,background:"none",width:190,height:240},type:"button",children:[I?e.jsx(D,{}):e.jsx($,{}),e.jsx("div",{style:{marginTop:8},children:"Upload"})]}),S=async p=>{const{onSuccess:g,onError:j,file:N,onProgress:s}=p,l=new FormData,T={headers:{"content-type":"multipart/form-data"},onUploadProgress:t=>{const R=Math.floor(t.loaded/t.total*100);f(R),R===100&&setTimeout(()=>f(0),1e3),s({percent:t.loaded/t.total*100})}};o&&l.append("book_id",o),l.append(c,N),l.append("old_file_url",d);try{r(!0);let t;m==="PATCH"?t=await F.patch(u,l,T):t=await F.post(u,l,T),g("Ok"),n(t.data.data),a(t.data.data),r(!1)}catch(t){j({err:t}),r(!1)}};return e.jsxs("div",{className:"mt-4",children:[e.jsx(w,{className:"mb-2",value:"Image Cover"}),e.jsxs(H,{accept:"image/png, image/jpeg",customRequest:S,name:c,listType:"picture",className:"book-cover",showUploadList:!1,action:route("profile.api.upload_avatar"),beforeUpload:Z,onChange:b,multiple:!1,maxCount:1,headers:{"X-CSRF-TOKEN":A("csrf-token")},children:[v?e.jsx(V,{preview:!1,fallback:E,src:G(`storage/${d}`),alt:"image",style:{width:"100%"}}):P,v?e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx(M,{className:"bg-transparent hover:bg-transparent",onClick:C,icon:e.jsx(X,{}),danger:!0,type:"dashed",shape:"circle"})}):null]}),e.jsx("div",{className:"h-4",children:x>0?e.jsx(q,{percent:x}):null})]})};var se=(a=>(a.create="create",a.update="update",a))(se||{});const ae={type:"create",categories:[],initialValues:{},bookId:0},ve=a=>{const i={...ae,...a},{type:c,categories:h,initialValues:u,bookId:m}=i,{data:o,post:x,patch:f,reset:I,setData:r,processing:d,errors:n,recentlySuccessful:v}=L(u),b=s=>{switch(s.preventDefault(),c){case"create":x(route("books.store"));break;case"update":f(route("books.update",m));break}},C=({target:{value:s}})=>{r("type",s)},P=({target:{value:s}})=>{r("status",s)},S=[{label:"Manga",value:"Manga"},{label:"Novel",value:"Novel"}],p=[{label:"Draft",value:"Draft"},{label:"Published",value:"Published"}],g=h.map(s=>({value:s.id,label:s.name})),j=s=>{r("categories",s)},N=m?{bookId:m}:{};return e.jsx(Y,{children:e.jsxs("form",{onSubmit:b,className:"mt-6 space-y-6",children:[e.jsx("div",{children:e.jsx(ee,{name:"cover_file",method:B.POST,action:route("books.upload.cover"),onChangeUrl:s=>r("img_url",s),value:o.img_url||"",...N})}),e.jsxs("div",{children:[e.jsx(U.Group,{name:"type",options:S,onChange:C,value:o.type,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(y,{className:"mt-2",message:n.type})]}),e.jsx(z,{label:"ชื่อเรื่อง",type:"text",value:o.title,onChange:s=>r("title",s.target.value),required:!0,isFocused:!0,errorMessage:n.title}),e.jsxs("div",{children:[e.jsx(w,{className:"mb-2",htmlFor:"synopsis",value:"เนื้อเรื่องย่อ"}),e.jsx(J,{size:"large",name:"synopsis",placeholder:"เนื้อเรื่องย่อ",autoSize:{minRows:3,maxRows:6},value:o.synopsis,onChange:s=>r("synopsis",s.target.value)}),e.jsx(y,{className:"mt-2",message:n.synopsis})]}),e.jsxs("div",{children:[e.jsx(w,{className:"mb-2",htmlFor:"categories",value:"Category"}),e.jsx(W,{mode:"multiple",allowClear:!0,showSearch:!0,filterOption:(s,l)=>((l==null?void 0:l.label)??"").toLowerCase().includes(s.toLowerCase()),style:{width:"100%"},placeholder:"Select Category",defaultValue:u.categories,value:o.categories,onChange:j,options:g,size:"large"}),e.jsx(K,{value:o.categories,list:h,onChange:j}),e.jsx(y,{className:"mt-2",message:n.categories})]}),u.status==="Published"?null:e.jsxs("div",{children:[e.jsx(U.Group,{name:"status",options:p,onChange:P,value:o.status,optionType:"button",buttonStyle:"solid",size:"large"}),e.jsx(y,{className:"mt-2",message:n.status})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{disabled:d,children:"Save"}),e.jsx(Q,{show:v,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Saved."})})]})]})})};export{ve as B,se as E};
